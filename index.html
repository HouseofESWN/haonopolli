<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XXXMatrix Chat</title>
    <title>XIXIXIMatrix Chat</title>
<style>
body {
background-color: black;
color: green;
            font-family: 'Courier New', monospace; /* Retro and consistent typography */
            font-family: 'Courier New', monospace;
margin: 0;
padding: 0;
display: flex;
flex-direction: column;
justify-content: center;
            align-items: center;
height: 100vh;
}
#chatOutput {
            flex-grow: 1;
            width: 90%;
            max-width: 800px;
            border: 1px solid green;
padding: 10px;
            margin-bottom: 10px;
overflow-y: auto;
            white-space: pre-wrap;
            font-size: 18px; /* Unified font size */
            font-weight: bold; /* Consistent boldness */
        }
        .prompt {
            color: green;
            font-weight: bold;
            height: 60%;
}
        .inputWrapper {
        #inputWrapper {
            width: 90%;
            max-width: 800px;
display: flex;
            align-items: center;
            position: relative;
            font-size: 18px; /* Match the font size of chatOutput */
            font-weight: bold; /* Match the font weight of chatOutput */
}
        .inputWrapper input {
        #inputField {
            flex-grow: 1;
background-color: black;
color: green;
            border: none;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            border: 1px solid green;
            padding: 10px;
        }
        #inputField:focus {
outline: none;
        }
        #submitButton {
            background-color: black;
            color: green;
            border: 1px solid green;
            padding: 10px;
font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 18px; /* Consistent font size */
            caret-color: transparent; /* Hides the default caret */
            width: 100%;
            position: relative;
            cursor: pointer;
}
        .blockCursor {
            position: absolute;
            width: 10px;
            height: 18px;
        #submitButton:hover {
background-color: green;
            animation: blink 1s steps(2) infinite;
            pointer-events: none; /* Prevent interaction with the cursor */
        }
        @keyframes blink {
            50% {
                background-color: black;
            }
            color: black;
}
</style>
</head>
<body>
<div id="chatOutput"></div>
    <div id="inputWrapper">
        <input type="text" id="inputField" placeholder="Type your message here...">
        <button id="submitButton">Send</button>
    </div>

<script>
// Store conversation history in memory
let conversationHistory = [];

const chatOutput = document.getElementById('chatOutput');
        const inputField = document.getElementById('inputField');
        const submitButton = document.getElementById('submitButton');

        // Function to append messages to the chat output
        function appendMessage(role, message) {
            console.log(`Appending message: [${role}] ${message}`);
            const newMessage = document.createElement('div');
            newMessage.textContent = `${role}: ${message}`;
            chatOutput.appendChild(newMessage);
            chatOutput.scrollTop = chatOutput.scrollHeight; // Auto-scroll to the bottom
        }

// Function to fetch AI response from the backend
        async function fetchAIResponse() {
        async function fetchAIResponse(userMessage) {
try {
                const response = await fetch('https://haonopollibackend-8dd8390a8f60.herokuapp.com/api/chat', { // Replace with your Heroku backend URL if different
                console.log("Sending request to backend...");
                conversationHistory.push({ role: "user", content: userMessage }); // Add user message to history

                const response = await fetch('https://haonopollibackend-8dd8390a8f60.herokuapp.com/api/chat', {
method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        messages: conversationHistory, // Send conversation history
                    }),
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ messages: conversationHistory }),
});

                const data = await response.json();
                if (data.response) {
                    return data.response;
                } else {
                    return 'Error: Failed to fetch AI response.';
                }
            } catch (error) {
                console.error('Error:', error);
                return 'Error: Unable to connect to the server.';
            }
        }

        // Function to display messages with typing animation
        async function displayMessage(sender, text) {
            const prompt = sender === 'user' ? '>' : 'H:';
            const messageElement = document.createElement('div');
            messageElement.style.fontWeight = 'bold'; // Ensure consistent boldness
            messageElement.style.fontSize = '18px'; // Ensure consistent font size
            messageElement.innerHTML = `<span class="prompt">${prompt}</span> `;
            chatOutput.appendChild(messageElement);

            for (let i = 0; i < text.length; i++) {
                messageElement.innerHTML += text[i];
                await new Promise((resolve) => setTimeout(resolve, 50)); // Typing effect (50ms per letter)
            }

            chatOutput.scrollTop = chatOutput.scrollHeight; // Scroll to bottom
        }

        // Function to handle user input
        async function handleUserInput(userMessage) {
            // Add user message to conversation history
            conversationHistory.push({ role: 'user', content: userMessage });
                console.log("Received response from backend:", response);

            // Display user message
            await displayMessage('user', userMessage);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

            // Fetch AI response
            const aiResponse = await fetchAIResponse();
                const data = await response.json();
                console.log("Parsed response data:", data);

            // Add AI response to conversation history
            conversationHistory.push({ role: 'assistant', content: aiResponse });
                const aiMessage = data.reply || "No reply received";
                conversationHistory.push({ role: "assistant", content: aiMessage }); // Add AI response to history

            // Display AI response
            await displayMessage('AI', aiResponse);
                // Append AI response to chat
                appendMessage("AI", aiMessage);
            } catch (error) {
                console.error("Error fetching AI response:", error);
                appendMessage("System", "Error: Unable to connect to the server.");
            }
}

        // Function to add a new input line
        function addInputLine() {
            const inputWrapper = document.createElement('div');
            inputWrapper.className = 'inputWrapper';
            inputWrapper.innerHTML = `<span class="prompt">></span> `;
            const inputField = document.createElement('input');
            const blockCursor = document.createElement('div');
            blockCursor.className = 'blockCursor';

            inputWrapper.appendChild(inputField);
            inputWrapper.appendChild(blockCursor);
            chatOutput.appendChild(inputWrapper);
            chatOutput.scrollTop = chatOutput.scrollHeight; // Scroll to bottom
        // Event listener for button click
        submitButton.addEventListener('click', () => {
            const userMessage = inputField.value.trim();
            if (userMessage) {
                appendMessage("You", userMessage); // Append user message to chat
                inputField.value = ""; // Clear the input field
                fetchAIResponse(userMessage); // Fetch AI response
            }
        });

            // Adjust block cursor position dynamically
            input
        // Event listener for Enter key
        inputField.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                submitButton.click();
            }
        });
    </script>
</body>
</html>
