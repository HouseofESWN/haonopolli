<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XXXMatrix Chat</title>
    <style>
        body {
            background-color: black;
            color: green;
            font-family: 'Courier New', monospace; /* Retro and consistent typography */
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            height: 100vh;
        }
        #chatOutput {
            flex-grow: 1;
            padding: 10px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-size: 18px; /* Unified font size */
            font-weight: bold; /* Consistent boldness */
        }
        .prompt {
            color: green;
            font-weight: bold;
        }
        .inputWrapper {
            display: flex;
            align-items: center;
            position: relative;
            font-size: 18px; /* Match the font size of chatOutput */
            font-weight: bold; /* Match the font weight of chatOutput */
        }
        .inputWrapper input {
            background-color: black;
            color: green;
            border: none;
            outline: none;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 18px; /* Consistent font size */
            caret-color: transparent; /* Hides the default caret */
            width: 100%;
            position: relative;
        }
        .blockCursor {
            position: absolute;
            width: 10px;
            height: 18px;
            background-color: green;
            animation: blink 1s steps(2) infinite;
            pointer-events: none; /* Prevent interaction with the cursor */
        }
        @keyframes blink {
            50% {
                background-color: black;
            }
        }
    </style>
</head>
<body>
    <div id="chatOutput"></div>

    <script>
        // Store conversation history in memory
        let conversationHistory = [];

        const chatOutput = document.getElementById('chatOutput');

        // Function to fetch AI response from the backend
        async function fetchAIResponse() {
            try {
                const response = await fetch('https://haonopollibackend-8dd8390a8f60.herokuapp.com/api/chat', { // Replace with your Heroku backend URL if different
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        messages: conversationHistory, // Send conversation history
                    }),
                });

                const data = await response.json();
                if (data.response) {
                    return data.response;
                } else {
                    return 'Error: Failed to fetch AI response.';
                }
            } catch (error) {
                console.error('Error:', error);
                return 'Error: Unable to connect to the server.';
            }
        }

        // Function to display messages with typing animation
        async function displayMessage(sender, text) {
            const prompt = sender === 'user' ? '>' : 'H:';
            const messageElement = document.createElement('div');
            messageElement.style.fontWeight = 'bold'; // Ensure consistent boldness
            messageElement.style.fontSize = '18px'; // Ensure consistent font size
            messageElement.innerHTML = `<span class="prompt">${prompt}</span> `;
            chatOutput.appendChild(messageElement);

            for (let i = 0; i < text.length; i++) {
                messageElement.innerHTML += text[i];
                await new Promise((resolve) => setTimeout(resolve, 50)); // Typing effect (50ms per letter)
            }

            chatOutput.scrollTop = chatOutput.scrollHeight; // Scroll to bottom
        }

        // Function to handle user input
        async function handleUserInput(userMessage) {
            // Add user message to conversation history
            conversationHistory.push({ role: 'user', content: userMessage });

            // Display user message
            await displayMessage('user', userMessage);

            // Fetch AI response
            const aiResponse = await fetchAIResponse();

            // Add AI response to conversation history
            conversationHistory.push({ role: 'assistant', content: aiResponse });

            // Display AI response
            await displayMessage('AI', aiResponse);
        }

        // Function to add a new input line
        function addInputLine() {
            const inputWrapper = document.createElement('div');
            inputWrapper.className = 'inputWrapper';
            inputWrapper.innerHTML = `<span class="prompt">></span> `;
            const inputField = document.createElement('input');
            const blockCursor = document.createElement('div');
            blockCursor.className = 'blockCursor';

            inputWrapper.appendChild(inputField);
            inputWrapper.appendChild(blockCursor);
            chatOutput.appendChild(inputWrapper);
            chatOutput.scrollTop = chatOutput.scrollHeight; // Scroll to bottom

            // Adjust block cursor position dynamically
            input
